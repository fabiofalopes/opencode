# OCMonitor Skill

Agent skill for monitoring and analyzing OpenCode AI coding sessions.

## Overview

**ocmonitor** is a CLI tool for monitoring OpenCode sessions - tracking token usage, costs, model analytics, and session performance. It reads OpenCode's internal storage to provide insights.

## Key Paths

```
# OpenCode Data Storage
~/.local/share/opencode/storage/message/    # Session message data (ses_* directories)
~/.local/share/opencode/storage/session/    # Session metadata (titles, etc.)

# OCMonitor Configuration
~/.config/ocmonitor/config.toml             # User configuration
~/projetos/hub/ocmonitor-share/models.json  # Model pricing data

# Export Directory
./exports/                                   # Default export location
```

## Core Commands

### Session Analysis

```bash
# Analyze all sessions
ocmonitor sessions

# Analyze with limit
ocmonitor sessions --limit 10

# Single session analysis
ocmonitor session /path/to/ses_xxxxx

# JSON output
ocmonitor sessions --format json
```

### Time-Based Reports

```bash
# Daily breakdown
ocmonitor daily
ocmonitor daily --month 2025-01

# Weekly breakdown (supports custom start day)
ocmonitor weekly
ocmonitor weekly --start-day sunday
ocmonitor weekly --breakdown    # Per-model breakdown

# Monthly breakdown
ocmonitor monthly
ocmonitor monthly --year 2025 --breakdown
```

### Project & Model Analytics

```bash
# Project usage breakdown
ocmonitor projects
ocmonitor projects --timeframe weekly

# Model usage statistics
ocmonitor models
ocmonitor models --timeframe monthly
ocmonitor models --start-date 2025-01-01 --end-date 2025-01-31
```

### Live Monitoring

```bash
# Real-time dashboard (auto-updates every 5s)
ocmonitor live

# Custom refresh interval
ocmonitor live --interval 10
```

### Data Export

```bash
# Export to CSV
ocmonitor export sessions --format csv --output sessions.csv
ocmonitor export daily --format csv

# Export to JSON
ocmonitor export models --format json --output models.json

# Available report types:
# session, sessions, daily, weekly, monthly, models, projects
```

### Configuration

```bash
# Show current config
ocmonitor config show
```

## Agent Usage Patterns

### When User Asks About Session Costs

```bash
# Quick cost overview
ocmonitor sessions --limit 5

# Model cost breakdown
ocmonitor models --timeframe all
```

### When User Wants to Track a Project

```bash
# Project-specific analytics
ocmonitor projects

# Filter by date range
ocmonitor projects --start-date 2025-01-01
```

### When User Needs to Monitor Current Session

```bash
# Start live dashboard
ocmonitor live

# Check session status
ocmonitor sessions --limit 1 --format json
```

### When User Wants Historical Data

```bash
# Weekly summary
ocmonitor weekly --breakdown

# Monthly trends
ocmonitor monthly --year 2025

# Export for further analysis
ocmonitor export monthly --format csv --output monthly_report.csv
```

## Data Model Reference

### Token Types

| Type | Description |
|------|-------------|
| input | Tokens sent to model |
| output | Tokens generated by model |
| cache_write | Tokens written to cache |
| cache_read | Tokens read from cache |

### Session Structure

```
ses_xxxxxxxxxxxxx/
├── msg_001.json    # Interaction file
├── msg_002.json
└── ...
```

### Interaction File Fields

```json
{
  "modelID": "claude-sonnet-4.5",
  "tokens": {
    "input": 1500,
    "output": 3200,
    "cache": {"write": 0, "read": 500}
  },
  "time": {
    "created": 1735000000000,
    "completed": 1735000015000
  },
  "path": {
    "cwd": "/path/to/project",
    "root": "/path/to/project"
  }
}
```

## Supported Models

Current pricing data includes:

**Free Tier (No Cost)**
- grok-code-fast-1, big-pickle, gpt-5-nano
- minimax-m2.1, glm-4.7

**Claude Family**
- claude-sonnet-4.5 ($3/M in, $15/M out, $6 quota)
- claude-haiku-4.5 ($1/M in, $5/M out)
- claude-opus-4.5 ($5/M in, $25/M out, $10 quota)

**Gemini Family**
- gemini-3-pro ($2/M in, $12/M out)
- gemini-3-flash ($0.50/M in, $3/M out)

**GPT Family**
- gpt-5.1-codex ($1.07/M in, $8.50/M out)
- gpt-5.2 ($1.75/M in, $14/M out)

**Other**
- kimi-k2 ($0.40/M in, $2.50/M out)
- qwen3-coder-480b ($0.45/M in, $1.50/M out)

## Live Dashboard Metrics

The live dashboard displays:

| Panel | Description |
|-------|-------------|
| Tokens | Input/output/cache breakdown |
| Cost | Session cost with quota progress |
| Context | Context window usage % |
| Rate | Token burn rate (tok/min) |
| Session Time | Duration with 5h max progress |
| Models | Per-model cost/token breakdown |

### Color Coding

| Color | Meaning |
|-------|---------|
| Green | < 50% usage |
| Yellow | 75-90% usage |
| Red | > 90% usage |

## Error Handling

Common issues:

1. **No sessions found**: Check path to message directory
2. **Unknown model**: Model not in models.json, cost = $0
3. **Missing pricing**: Add model to models.json

## Integration with Agent Workflow

### Before Starting Work

```bash
# Check current session status
ocmonitor live &  # Run in background
```

### During Session

```bash
# Quick stats
ocmonitor sessions --limit 1
```

### After Session

```bash
# Generate report
ocmonitor export sessions --format csv --output report.csv

# Check model usage
ocmonitor models --timeframe daily
```

## Configuration File

Location: `~/.config/ocmonitor/config.toml`

```toml
[paths]
messages_dir = "~/.local/share/opencode/storage/message"
export_dir = "./exports"

[ui]
table_style = "rich"    # rich, simple, minimal
progress_bars = true
colors = true
live_refresh_interval = 5

[export]
default_format = "csv"
include_metadata = true

[analytics]
default_timeframe = "daily"
recent_sessions_limit = 50
```

## Quick Reference

| Task | Command |
|------|---------|
| Current costs | `ocmonitor sessions -l 1` |
| Live monitor | `ocmonitor live` |
| Daily summary | `ocmonitor daily` |
| Model breakdown | `ocmonitor models --breakdown` |
| Project costs | `ocmonitor projects` |
| Export CSV | `ocmonitor export sessions -f csv` |
| Config check | `ocmonitor config show` |
